<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Pareto smoothed importance sampling (PSIS) — psislw • loo</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">loo</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="http://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstanarm">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org">Stan</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/rstanarm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Pareto smoothed importance sampling (PSIS)</h1>
    </div>

    
    <p>Implementation of Pareto smoothed importance sampling, a method for
stabilizing importance weights. For full details about the algorithm see
Vehtari, Gelman and Gabry (2016, 2017). For diagnostics see the
<a href='pareto-k-diagnostic.html'>pareto-k-diagnostic</a> page.</p>
    

    <pre class="usage"><span class='fu'>psislw</span>(<span class='no'>lw</span>, <span class='kw'>wcp</span> <span class='kw'>=</span> <span class='fl'>0.2</span>, <span class='kw'>wtrunc</span> <span class='kw'>=</span> <span class='fl'>3</span>/<span class='fl'>4</span>, <span class='kw'>cores</span> <span class='kw'>=</span> <span class='fu'>getOption</span>(<span class='st'>"loo.cores"</span>,
  <span class='kw'>parallel</span><span class='kw'>::</span><span class='fu'>detectCores</span>()), <span class='kw'>llfun</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>llargs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>lw</th>
      <td><p>A matrix or vector of log weights. For computing LOO, <code>lw =
-log_lik</code>, the <em>negative</em> of an \(S\) (simulations) by \(N\) (data
points) pointwise log-likelihood matrix.</p></td>
    </tr>
    <tr>
      <th>wcp</th>
      <td><p>The proportion of importance weights to use for the generalized
Pareto fit. The <code>100*wcp</code>% largest weights are used as the sample
from which to estimate the parameters of the generalized Pareto
distribution.</p></td>
    </tr>
    <tr>
      <th>wtrunc</th>
      <td><p>For truncating very large weights to \(S\)^<code>wtrunc</code>. Set
to zero for no truncation.</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>The number of cores to use for parallelization. This can be set
for an entire R session by <code>options(loo.cores = NUMBER)</code>. The default
is <code><a href='http://www.rdocumentation.org/packages/parallel/topics/detectCores'>detectCores</a></code>().</p></td>
    </tr>
    <tr>
      <th>llfun, llargs</th>
      <td><p>See <code><a href='loo.html'>loo.function</a></code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Ignored when <code>psislw</code> is called directly. The <code>...</code> is
only used internally when <code>psislw</code> is called by the <code><a href='loo.html'>loo</a></code>
function.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A named list with components <code>lw_smooth</code> (modified log weights)
  and <code>pareto_k</code> (estimated generalized
  Pareto <a href='pareto-k-diagnostic.html'>shape parameter(s) k</a>).</p>
    
    <h2 class="hasAnchor" id="psis-loo"><a class="anchor" href="#psis-loo"></a>PSIS-LOO</h2>

    <p>The distribution of the importance weights used in LOO may
  have a long right tail. We use the empirical Bayes estimate of Zhang and
  Stephens (2009) to fit a generalized Pareto distribution (gPd) to the tail
  (20% largest importance ratios). By examining the shape parameter \(k\)
  of the fitted gPd, we are able to obtain sample based estimates of the
  existance of the moments (Koopman et al, 2009). This extends the diagnostic
  approach of Peruggia (1997) and Epifani et al. (2008) to be used routinely
  with importance-sampling LOO for any model with a factorizing likelihood.</p>
<p>Epifani et al. (2008) show that when estimating the leave-one-out
  predictive density, the central limit theorem holds if the variance of the
  weight distribution is finite. These results can be extended using the
  generalized central limit theorem for stable distributions. Thus, even if
  the variance of the importance weight distribution is infinite, if the mean
  exists the estimate's accuracy improves when additional draws are obtained.
  When the tail of the weight distribution is long, a direct use of
  importance sampling is sensitive to one or few largest values. By fitting a
  gPd to the upper tail of the importance weights we smooth these values. The
  procedure (implemented in the <code>psislw</code> function) goes as
  follows:</p><ol>
<li><p>Fit the gPd to the 20% largest importance ratios \(r_s\). The
  computation is done separately for each held-out data point \(i\). In
  simulation experiments with thousands and tens of thousands of draws, we
  have found that the fit is not sensitive to the specific cutoff value (for
  a consistent estimation the proportion of the samples above the cutoff
  should get smaller when the number of draws increases).</p></li>
<li><p>Stabilize the importance ratios by replacing the \(M\) largest
  ratios by the expected values of the order statistics of the fitted
  gPd $$G((z - 0.5)/M), z = 1,...,M,$$ where
  \(M\) is the number of simulation draws used to fit the Pareto (in this
  case, \(M = 0.2*S\)) and \(G\) is the inverse-CDF of the gPd.</p></li>
<li><p>To guarantee finite variance of the estimate, truncate the smoothed
  ratios with $$S^{3/4}\bar{w},$$ where \(\bar{w}\) is the average of
  the smoothed weights.</p></li>
</ol>
    <p>The above steps must be performed for each data point \(i\). The result is
a vector of weights \(w_{i}^{s}, s = 1,...,S\), for each \(i\), which in
general should be better behaved than the raw importance ratios
\(r_{i}^{s}\) from which they were constructed.</p>
<p>The results can be then combined to compute the desired LOO estimates.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Vehtari, A., Gelman, A., and Gabry, J. (2017). Practical
  Bayesian model evaluation using leave-one-out cross-validation and WAIC.
  <em>Statistics and Computing</em>. 27(5), 1413--1432.
  doi:10.1007/s11222-016-9696-4.
  (<a href = 'http://link.springer.com/article/10.1007%2Fs11222-016-9696-4'>published
  version</a>, <a href = 'http://arxiv.org/abs/1507.04544'>arXiv preprint</a>).</p>
<p>Vehtari, A., Gelman, A., and Gabry, J. (2016). Pareto smoothed
  importance sampling. arXiv preprint: <a href = 'http://arxiv.org/abs/1507.02646/'>http://arxiv.org/abs/1507.02646/</a></p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='pareto-k-diagnostic.html'>pareto-k-diagnostic</a></code> for PSIS diagnostics.</p>
    

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#psis-loo">PSIS-LOO</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
          </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Aki Vehtari, Andrew Gelman, Jonah Gabry.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
