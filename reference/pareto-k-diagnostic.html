<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Diagnostics for Pareto smoothed importance sampling (PSIS) — pareto-k-diagnostic • loo</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Diagnostics for Pareto smoothed importance sampling (PSIS) — pareto-k-diagnostic" />
<meta property="og:description" content="Print a diagnostic table summarizing the estimated Pareto shape parameters
and PSIS effective sample sizes, find the indexes of observations for which
the estimated Pareto shape parameter \(k\) is larger than some
threshold value, or plot observation indexes vs. diagnostic estimates.
The Details section below provides a brief overview of the
diagnostics, but we recommend consulting Vehtari, Gelman, and Gabry (2017)
and Vehtari, Simpson, Gelman, Yao, and Gabry (2019) for full details." />
<meta property="og:image" content="https://mc-stan.org/loo/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">loo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/cmdstanr">cmdstanr</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstanarm">rstanarm</a>
    </li>
    <li>
      <a href="https://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="https://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/projpred">projpred</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstantools">rstantools</a>
    </li>
    <li>
      <a href="https://mc-stan.org/posterior">posterior</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://mc-stan.org">Stan</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/loo">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://discourse.mc-stan.org/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Diagnostics for Pareto smoothed importance sampling (PSIS)</h1>
    <small class="dont-index">Source: <a href='https://github.com/stan-dev/loo/blob/master/R/diagnostics.R'><code>R/diagnostics.R</code></a></small>
    <div class="hidden name"><code>pareto-k-diagnostic.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Print a diagnostic table summarizing the estimated Pareto shape parameters
and PSIS effective sample sizes, find the indexes of observations for which
the estimated Pareto shape parameter \(k\) is larger than some
<code>threshold</code> value, or plot observation indexes vs. diagnostic estimates.
The <strong>Details</strong> section below provides a brief overview of the
diagnostics, but we recommend consulting Vehtari, Gelman, and Gabry (2017)
and Vehtari, Simpson, Gelman, Yao, and Gabry (2019) for full details.</p>
    </div>

    <pre class="usage"><span class='fu'>pareto_k_table</span>(<span class='no'>x</span>)

<span class='fu'>pareto_k_ids</span>(<span class='no'>x</span>, <span class='kw'>threshold</span> <span class='kw'>=</span> <span class='fl'>0.5</span>)

<span class='fu'>pareto_k_values</span>(<span class='no'>x</span>)

<span class='fu'>pareto_k_influence_values</span>(<span class='no'>x</span>)

<span class='fu'>psis_n_eff_values</span>(<span class='no'>x</span>)

<span class='fu'>mcse_loo</span>(<span class='no'>x</span>, <span class='kw'>threshold</span> <span class='kw'>=</span> <span class='fl'>0.7</span>)

<span class='co'># S3 method for psis_loo</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(
  <span class='no'>x</span>,
  <span class='kw'>diagnostic</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"k"</span>, <span class='st'>"n_eff"</span>),
  <span class='no'>...</span>,
  <span class='kw'>label_points</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"PSIS diagnostic plot"</span>
)

<span class='co'># S3 method for psis</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(
  <span class='no'>x</span>,
  <span class='kw'>diagnostic</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"k"</span>, <span class='st'>"n_eff"</span>),
  <span class='no'>...</span>,
  <span class='kw'>label_points</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"PSIS diagnostic plot"</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>An object created by <code><a href='loo.html'>loo()</a></code> or <code><a href='psis.html'>psis()</a></code>.</p></td>
    </tr>
    <tr>
      <th>threshold</th>
      <td><p>For <code>pareto_k_ids()</code>, <code>threshold</code> is the minimum \(k\)
value to flag (default is <code>0.5</code>). For <code>mcse_loo()</code>, if any \(k\)
estimates are greater than <code>threshold</code> the MCSE estimate is returned as
<code>NA</code> (default is <code>0.7</code>). See <strong>Details</strong> for the motivation behind these
defaults.</p></td>
    </tr>
    <tr>
      <th>diagnostic</th>
      <td><p>For the <code>plot</code> method, which diagnostic should be
plotted? The options are <code>"k"</code> for Pareto \(k\) estimates (the
default) or <code>"n_eff"</code> for PSIS effective sample size estimates.</p></td>
    </tr>
    <tr>
      <th>label_points, ...</th>
      <td><p>For the <code><a href='https://rdrr.io/r/graphics/plot.html'>plot()</a></code> method, if <code>label_points</code> is
<code>TRUE</code> the observation numbers corresponding to any values of \(k\)
greater than 0.5 will be displayed in the plot. Any arguments specified in
<code>...</code> will be passed to <code><a href='https://rdrr.io/r/graphics/text.html'>graphics::text()</a></code> and can be used
to control the appearance of the labels.</p></td>
    </tr>
    <tr>
      <th>main</th>
      <td><p>For the <code><a href='https://rdrr.io/r/graphics/plot.html'>plot()</a></code> method, a title for the plot.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>pareto_k_table()</code> returns an object of class
<code>"pareto_k_table"</code>, which is a matrix with columns <code>"Count"</code>,
<code>"Proportion"</code>, and <code>"Min. n_eff"</code>, and has its own print method.</p>
<p><code>pareto_k_ids()</code> returns an integer vector indicating which
observations have Pareto \(k\) estimates above <code>threshold</code>.</p>
<p><code>pareto_k_values()</code> returns a vector of the estimated Pareto
\(k\) parameters. These represent the reliability of sampling.</p>
<p><code>pareto_k_influence_values()</code> returns a vector of the estimated Pareto
\(k\) parameters. These represent influence of the observations on the
model posterior distribution.</p>
<p><code>psis_n_eff_values()</code> returns a vector of the estimated PSIS
effective sample sizes.</p>
<p><code>mcse_loo()</code> returns the Monte Carlo standard error (MCSE)
estimate for PSIS-LOO. MCSE will be NA if any Pareto \(k\) values are
above <code>threshold</code>.</p>
<p>The <code><a href='https://rdrr.io/r/graphics/plot.html'>plot()</a></code> method is called for its side effect and does not
return anything. If <code>x</code> is the result of a call to <code><a href='loo.html'>loo()</a></code>
or <code><a href='psis.html'>psis()</a></code> then <code><a href='https://rdrr.io/r/graphics/plot.html'>plot(x, diagnostic)</a></code> produces a plot of
the estimates of the Pareto shape parameters (<code>diagnostic = "k"</code>) or
estimates of the PSIS effective sample sizes (<code>diagnostic = "n_eff"</code>).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The reliability and approximate convergence rate of the PSIS-based estimates
can be assessed using the estimates for the shape parameter \(k\) of the
generalized Pareto distribution:</p><ul>
<li><p>If \(k &lt; 0.5\) then the distribution of raw importance ratios has
finite variance and the central limit theorem holds. However, as \(k\)
approaches \(0.5\) the RMSE of plain importance sampling (IS) increases
significantly while PSIS has lower RMSE.</p></li>
<li><p>If \(0.5 \leq k &lt; 1\) then the variance of the raw
importance ratios is infinite, but the mean exists. TIS and PSIS estimates
have finite variance by accepting some bias. The convergence of the
estimate is slower with increasing \(k\).
If \(k\) is between 0.5 and approximately 0.7 then we observe practically
useful convergence rates and Monte Carlo error estimates with PSIS (the
bias of TIS increases faster than the bias of PSIS). If \(k &gt; 0.7\) we
observe impractical convergence rates and unreliable Monte Carlo error
estimates.</p></li>
<li><p>If \(k \geq 1\) then neither the variance nor the mean of
the raw importance ratios exists. The convergence rate is close to
zero and bias can be large with practical sample sizes.</p></li>
</ul>

<h3>What if the estimated tail shape parameter \(k\) exceeds
\(0.5\)</h3>
<p>Importance sampling is likely to work less well if the
marginal posterior \(p(\theta^s | y)\) and LOO posterior
\(p(\theta^s | y_{-i})\) are very different, which is more likely to
happen with a non-robust model and highly influential observations.
If the estimated tail shape parameter \(k\) exceeds \(0.5\), the user
should be warned. (Note: If \(k\) is greater than \(0.5\)
then WAIC is also likely to fail, but WAIC lacks its own diagnostic.)
In practice, we have observed good performance for values of \(k\) up to 0.7.
When using PSIS in the context of approximate LOO-CV, we recommend one of
the following actions when \(k &gt; 0.7\):</p><ul>
<li><p>With some additional computations, it is possible to transform the MCMC
draws from the posterior distribution to obtain more reliable importance
sampling estimates. This results in a smaller shape parameter \(k\).
See <code><a href='loo_moment_match.html'>loo_moment_match()</a></code> for an example of this.</p></li>
<li><p>Sampling directly from \(p(\theta^s | y_{-i})\) for the problematic
observations \(i\), or using \(k\)-fold cross-validation will generally
be more stable.</p></li>
<li><p>Using a model that is more robust to anomalous observations will
generally make approximate LOO-CV more stable.</p></li>
</ul>



<h3>Observation influence statistics</h3>
<p>The estimated shape parameter
\(k\) for each observation can be used as a measure of the observation's
influence on posterior distribution of the model. These can be obtained with
<code>pareto_k_influence_values()</code>.</p>

<h3>Effective sample size and error estimates</h3>
<p>In the case that we
obtain the samples from the proposal distribution via MCMC the <strong>loo</strong>
package also computes estimates for the Monte Carlo error and the effective
sample size for importance sampling, which are more accurate for PSIS than
for IS and TIS (see Vehtari et al (2017b) for details). However, the PSIS
effective sample size estimate will be
<strong>over-optimistic when the estimate of \(k\) is greater than 0.7</strong>.</p>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Vehtari, A., Gelman, A., and Gabry, J. (2017a). Practical Bayesian model
evaluation using leave-one-out cross-validation and WAIC.
<em>Statistics and Computing</em>. 27(5), 1413--1432. doi:10.1007/s11222-016-9696-4
(<a href='http://link.springer.com/article/10.1007%2Fs11222-016-9696-4'>journal version</a>,
<a href='https://arxiv.org/abs/1507.04544'>preprint arXiv:1507.04544</a>).</p>
<p>Vehtari, A., Simpson, D., Gelman, A., Yao, Y., and Gabry, J. (2019).
Pareto smoothed importance sampling.
<a href='https://arxiv.org/abs/1507.02646/'>preprint arXiv:1507.02646</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='psis.html'>psis()</a></code> for the implementation of the PSIS algorithm.</p></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Aki Vehtari, Jonah Gabry, Mans Magnusson, Yuling Yao, Paul-Christian Bürkner, Topi Paananen, Andrew Gelman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


